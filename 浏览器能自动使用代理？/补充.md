# 系统代理
系统代理设置顾名思义就是Shadowssocks(R)在系统设置里面设置一个代理服务器，让软件可以直接调用系统代理设置直接连接代理服务器，而不需要单独的配置。

一般而言，只有浏览器（包括内嵌在各种软件中的浏览器，比如 WeGame、优酷、迅雷9等软件中的内嵌浏览器）会自动调用系统代理进行连接。

而其它大部分应用一般是不会自动启用系统代理进行连接的，所以我们的服务对电脑客户端软件不生效，要在支持使用代理的软件里面进行手动设置 。

系统代理模式和代理规则选项是相互配合使用的，先用系统代理模式来判断是否让数据进入SSR客户端，再用代理规则来判断进入SSR客户端的数据是直连还是走代理。


# 透明代理
透明代理的意思是客户端不需要知道有代理服务器的存在，它改变 request fields（报文）并传送真实 IP。本文中的透明代理是指使用 Clash 的 TUN 模式虚拟出来的一块 TUN 网卡，作为局域网中的网关，从而实现透明代理。

Clash 中的透明代理选项可以设置为使用 TAP 或 TUN 设备，它们的工作原理是相同的，区别在于 TUN 设备是一个三层设备，它只模拟到了网络层。我们可以通过 /dev/tunX 文件收发 IP 层数据包，它无法与物理网卡做 bridge，但是可以通过三层交换（如 ip_forward）与物理网卡连通。可以使用 ifconfig 之类的命令给该设备设定 IP 地址。而 TAP 设备是一个二层设备，它比 TUN 更加深入，通过 /dev/tapX 文件可以收发数据链路层的包，拥有 MAC 层功能，可以与物理网卡做 bridge，支持 MAC 层广播。同样的，我们也可以通过 ifconfig 之类的命令给该设备设定 IP 地址，我们也可以给它设定 MAC 地址。

关于为什么不使用系统代理而选择 TUN/TAP 透明代理，Clash For Windows 的官方文档给了这样一句话：

对于不遵循系统代理的软件，TUN 模式可以接管其流量并交由 CFW 处理，在 Windows 中，TUN 模式性能比 TAP 模式好。

https://blog.muted.top/2021/11/06/%E5%85%B3%E4%BA%8E%E4%BD%BF%E7%94%A8Clash%E7%9A%84TUN%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%B8%80%E5%88%87/


# 手机端
- 浏览器可以自动获取系统代理并使用
- 一般客户端（如：应用商店）不会自动使用代理

# 抓包原理
- https://juejin.cn/post/6844903809068564493#heading-3
- https://juejin.cn/post/6850418120629485582#heading-13
- https://juejin.cn/post/6875474994336366606

# 禁用代理
- https://juejin.cn/post/6860818685763223565

# 自动配置代理
基于pac实现手机一键配置代理
- pac服务：
    - 局域网内开启pac服务
    - pac服务：自动读取系统代理，生成系统代理pac脚本
    - pac服务：pac脚本访问服务
    - pac服务：pac脚本增删改查接口
    - pac脚本默认类型：系统代理、直连
    - 管理页面：pac脚本增删改查功能
    - 管理页面：设置系统代理类型
    - 管理页面：自动生成页面链接二维码，手机可扫码访问该页面
    - 管理页面：一键复制pac脚本链接
- 手机客户端：
    - 初始化：配置pac服务ip、端口
    - pac服务管理页面：增删改查pac脚本
    - 系统权限：一键设置手机网络代理pac脚本链接
    - 系统权限：自动检测pac脚本链接是否可用，不可用时自动关闭代理

# 手机+pc同步抓包
- 手机客户端
    - 本地开启代理
    - 一键设置手机网络代理
    - 抓包同步给pc客户端

- pc客户端
    - 接收手机客户端同步信息
    - 增删改查网络请求包
